@startuml
title Submit mutation to key server

() "User"
() "Tree"
() "Queuer"
() "Sequencer"
() "Appender"
[Signer]
[FE]

database "Spanner" {
folder "Map" {
	[Mutations]
	[Queue]
	[Leaves]
	[Nodes]
	[SignedTreeHeads]
	}
folder "Privacy" {
	[Commitments]
}
}

User -> FE 		: 1. UpdateEntry(email, mutation)
FE --> Committer	: 2. Save Commitment
Committer -> Commitments
FE --> Queuer 		: 3. Queue Mutation
Queuer --> Queue
Queuer -> Mutations
Queue --> Sequencer	: 4. DB Callback

Sequencer --> Signer	: 5. Go Channel
Signer <--> Tree	: 6. WriteLeaf
Tree --> Leaves
Tree --> Nodes
Signer --> Appender 	: 7. CreateEpoch
Appender --> SignedTreeHeads
@enduml

@startuml
title Retrieve Merkle Tree Proof

() "User"
() "Tree"
() "Appender"
[FE]

database "Spanner" {
folder "Map" {
	[Leaves]
	[Nodes]
	[SignedTreeHeads]
	}
folder "Privacy" {
	[Commitments]
}
}

User -> FE		: 1. GetEntry(email, timestamp)
FE --> Tree		: 2. GetLeaf
Tree <- Leaves
FE --> Tree		: 2. GetNeighbors
Tree <- Nodes
FE --> Committer		: 3. GetCommitment
Committer <- Commitments
FE --> Appender
Appender <- SignedTreeHeads

@enduml
